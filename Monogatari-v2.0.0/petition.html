<html>
<head>
	<title>Poster</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/trontastic/jquery-ui.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
	<style>
		#container
		{
			width: 850px;
			border: 2px solid black;
			border-radius: 20px;
			margin: 10px auto;
			padding: 10px;
		}
		#pieceContainer
		{
			width: 408px;
			height: 292px;
			border: 1px solid black;
			float: left;
			text-align: center;
			font-size: 30px;
			line-height: 400px;
			position: relative;
		}
		#puzzleContainer
		{
			width: 408px;
			height: 292px;
			border: 1px solid black;
			float: right;
			background-size: fill;
		}
		#colorContainer
		{
			width: 50px;
			height: 50px;
			background-repeat: no-repeat;
			float: center;
			position: absolute;
		}
		#test
		{
			width: 50px;
			height: 50px;
			background-repeat: no-repeat;
			float: center;
			position: absolute;
		}
		#posterContainer
		{
			width: 100%;
			height: 100%;
			background-repeat: no-repeat;
			float: center;
		}
		.poster
		{
			width: 100%;
			height: 100%;
			float: center;
			background-image:url(assets/minigames/poster.png);
			background-repeat: no-repeat;
			background-size: cover;
		}
		.text
		{
			width: 100%;
			height: 100%;
			float: center;
			background-image:url(assets/minigames/text.png);
			background-repeat: no-repeat;
			background-size: cover;
		}
		.blue
		{
			width: 50px;
			height: 50px;
			float: center;
			background-image:url(assets/minigames/bubbles/Bubble_with_text_01.png);
			background-repeat: no-repeat;
			background-size: cover;
		}
		.yellow
		{
			width: 100px;
			height: 100px;
			float: center;
			background-image:url(assets/minigames/Color_Yellow.png);
			background-repeat: no-repeat;
			background-size: cover;
		}
		.right
		{
			width: 100px;
			height: 100px;
			float: center;
			background-image:url(assets/minigames/Color_Yellow.png);
			background-repeat: no-repeat;
			background-size: cover;
		}
		.left
		{
			width: 100px;
			height: 100px;
			float: center;
			background-image:url(assets/minigames/Color_Yellow.png);
			background-repeat: no-repeat;
			background-size: cover;
		}
		.red
		{
			width: 50px;
			height: 50px;
			float: center;
			background-image:url(assets/minigames/Color_Red.png);
			background-repeat: no-repeat;
			background-size: fill;
			background-size: cover;
		}
		.nude
		{
			width: 50px;
			height: 50px;
			float: center;
			background-image:url(assets/minigames/Color_Nude.png);
			background-repeat: no-repeat;
			background-size: fill;
			background-size: cover;
		}
		.white
		{
			width: 50px;
			height: 50px;
			float: center;
			background-image:url(assets/minigames/Color_White.png);
			background-repeat: no-repeat;
			background-size: fill;
			background-size: cover;
		}
		.black
		{
			width: 50px;
			height: 50px;
			float: center;
			background-image:url(assets/minigames/Color_Black.png);
			background-repeat: no-repeat;
			background-size: fill;
			background-size: cover;
		}
		ul
		{
			list-style-type: none;
			text-align: center;
		}
		ul button
		{
			width: 100px;
			border: 1px solid black;
			font-size: 20px;
			border-radius: 5px;
			padding: 5px;
			margin-top: 10px;
		}
		#btnReset
		{
			display: none;
		}
		.piece
		{
			width: 100px;
			height: 71px;
			border: 1px solid black;
			float: left;
			background-image:url(assets/minigames/b3c0ff.png);
			background-repeat: no-repeat;
		}
	</style>
	<script>
		$(document).ready(function() {
			//var pieces = createPieces(true);
			//$("#puzzleContainer").html(pieces);

			
			moveBubbles();
			$("#btnStart").click(function(){

				var pieces = $("#puzzleContainer div");
				pieces.each(function(){
					var leftPosition = Math.floor(Math.random() * 290 + 0) + "px";
					var topPosition = Math.floor(Math.random() * 204 + 0) + "px";
					$(this).addClass("draggablePiece").css({
						position: "absolute",
						left: leftPosition,
						top: topPosition
					})
					$("#pieceContainer").append($(this));
				});
				var emptyString = createPieces(false);
				$("#puzzleContainer").html(emptyString);
				$(this).hide();
				$("#btnReset").show();
				implementLogic();
			});
			$("#btnReset").click(function() {
				var newPieces = createPieces(true);
				$("#puzzleContainer").html(newPieces);
				$(this).hide();
				$("#btnStart").show();
				$("#pieceContainer").empty();
			});
			function createPieces(withImage) {
				var rows = 4, columns = 4;
				var pieces = "";
				for (var i = 0, top = 0, order = 0; i < rows; i++, top -= 71) {
					for (var j = 0, left = 0; j < columns; j++, left -= 100, order++) {
						if (withImage)
							pieces += "<div style='background-position: " + left + "px " + top + "px;' class='piece' data-order=" + order + "></div>";
						else
							pieces += "<div style='background-image: none;' class='piece droppableSpace'></div>";
					}
				}
				return pieces;
			}
			function checkIfPuzzleSolved() {
				if ($("#puzzleContainer .droppedPiece").length != 16)
					return false;
				for (var k = 0; k < 16; k++) {
					var item = $("#puzzleContainer .droppedPiece:eq(" + k + ")");
					var order = item.data("order");
					if (k != order) {
						$("#pieceContainer").text("Whoops! Try again!");
						return false;
					}
				}
				$("#pieceContainer").text("Wow! This is a great website!");
				return true;
			}
			function implementLogic() {
				$(".draggablePiece").draggable({
					revert: "invalid",
					start: function() {
						if ($(this).hasClass("droppedPiece")) {
							$(this).removeClass("droppedPiece");
							$(this).parent().removeClass("piecePresent");
						}
					}
				});
				$(".droppableSpace").droppable({
					hoverClass: "ui-state-highlight",
					accept: function() {
						return !$(this).hasClass("piecePresent");
					},
					drop: function(event, ui) {
						var draggableElement = ui.draggable;
						var droppedOn = $(this);
						droppedOn.addClass("piecePresent");
						$(draggableElement).addClass("droppedPiece").css({
							position: "relative",
							left: 0,
							top: 0
						}).appendTo(droppedOn);
						checkIfPuzzleSolved();
					}
				});
			}
		});
		function allowDrop(ev) {
		  ev.preventDefault();
		}

		function drag(ev) {
		  ev.dataTransfer.setData("text", ev.target.id);
		}

		function drop(ev) {
		  ev.preventDefault();
		  var data = ev.dataTransfer.getData("text");
		  ev.target.appendChild(document.getElementById(data));
		  if(ev.target.id=="text"){
		  	var x = parseInt(ev.target.innerHTML);
		  	ev.target.innerHTML = x + 1;
		  	ev.target.style.color=data;
		  }else{
		  	ev.target.style.backgroundColor=data;
		  }

		}
			var id = null;
		function moveBubbles() {
		  var pieces = $("#bubbles div");
				
		  console.log("hello!"); 
		  var pos = 500;
		  var min = 500;
		  var max = 1000;
		  clearInterval(id);
		  id = setInterval(frame, 100);
		  var f = 0;
		  function frame() {
		  //	console.log(pos);
		  	pieces.each(function(){
		  		if(document.getElementById(this.id) != null){
			  		var currentLeft = parseInt(document.getElementById(this.id).style.left);
			  		//console.log(this.id + " Current Left: " + currentLeft + " Dir: " + this.className);
					if(this.className == 'right'){	
						if (currentLeft == max) {
					      clearInterval(id);
					    } else {
					      currentLeft++; 
					      $(this).css({
								position: "absolute",
								left: currentLeft + 'px'
							})
					 //    console.log("new Left? " + currentLeft);
					   //  console.log("new Left " + this.style.left);
					    }
					}else{
						if (currentLeft == min) {
					      clearInterval(id);
					    } else {
					      currentLeft--; 
					      $(this).css({
								position: "absolute",
								left: currentLeft + 'px'
							})
					    }
					}
					
				}
			});
				if(f % 50 == 0){
						console.log("new bubble: " + f);
						//add new bubble
						var left = min;
						var dir = 'right';
						if(Math.floor(Math.random() * 2) == 1){
							dir = 'left';
							left = max;
						} 
						var bubDec = '';
						var bubNum = Math.floor(Math.random() * 23 + 0) + 1;
						if(bubNum < 10) bubDec = '0';

						console.log(bubNum);
						document.getElementById("bubbles").innerHTML = document.getElementById("bubbles").innerHTML + "<div id='bubNum_" + bubNum + "' class='" + dir + "' draggable='true' ondragstart='drag(event)' style='background-image:url(assets/minigames/bubbles/Bubble_with_text_" + bubDec + bubNum + ".png); top:" + Math.floor(Math.random() * 20 + 0) * 20 + "px; left:" + left + "px;'></div>";

			  			pieces = $("#bubbles div");
					}
					f++;
		    
		  }
		}
	</script>
</head>
<body>
	<div id="container">
		<div id="bubbles" class ="bubbles">

				<div id="blue" draggable="true" ondragstart="drag(event)" class="left" style="top: 50px; left:100px;"></div>
				<!--
				<div id="white" draggable="true" ondragstart="drag(event)" class="right" style="top:150px; left:10px;"></div>

				<div id="red" draggable="true" ondragstart="drag(event)" class="left" style="top:200px; left:10px;"></div>

				<div id="nude" draggable="true" ondragstart="drag(event)" class="right"style="top:250px; left:10px;"></div>

				<div id="black" draggable="true" ondragstart="drag(event)" class="left" style="top:300px; left:10px;"></div>
-->
			<p style="color:#FF0000; font-family:Monaco; font-size:50px; text-align: center;"; ondrop="drop(event)" ondragover="allowDrop(event)" id="text">0</p>
			</div></div>
		<ul id="buttons">
			<li><button id="btnStart">Start</button></li>
			<li><button id="btnReset">Reset</button></li>
		</ul>
	</div>
</body>
</html>